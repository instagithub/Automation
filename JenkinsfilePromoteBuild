@Library("ve-lib@test/apps/branchlib")
@Library("apps-lib@master") _

env.GIT_REPO_URL = "https://git.pega.io/scm/crm/crm-all.git"
env.ARTIFACTORY_URL = "https://internal.bin.pega.io/artifactory"
env.ARTIFACTORY_REPO = "https://internal.bin.pega.io/artifactory/repo2"
env.CLOUD_ARTIFACTORY_URL='https://cirrus.jfrog.io/cirrus'

node('CRM-image-jdk8') {
    withCredentials([usernamePassword(credentialsId: 'artifactory2', passwordVariable: 'ARTIFACTORY_PASSWORD', usernameVariable: 'ARTIFACTORY_USER')]) {
            writeFile file: "/root/.gradle/gradle.properties",
                    text: "artifactoryUser=${ARTIFACTORY_USER}\n" +
                            "artifactoryPassword=${ARTIFACTORY_PASSWORD}\n" +
                            "artifactoryURL=${ARTIFACTORY_URL}\n"
    }
    try {
        checkout scm
        stage('Promote Build') {
            sh "chmod a+x gradlew && sleep 2 && ./gradlew --no-daemon copyArtifact -Pversion=${this.BUILD_NUMBER} -Prepo=${this.FROM_REPO} -PtargetRepo=${this.TO_REPO}"
        }
    } catch (Exception e) {
        currentBuild.result = "FAILURE"
        throw e
    }finally {

    }
}
